<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenith | The Coding Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Anime/Sci-Fi Font -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,400;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Import Map for Three.js -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js"
            }
        }
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Exo 2"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        zenith: {
                            bg: '#09090b',       // Deep Void
                            card: '#121217',     // Dark Plate
                            border: '#27272a',   // Metal
                            cyan: '#00f3ff',     // Cyber Cyan
                            pink: '#ff0055',     // Neon Pink
                            purple: '#bd00ff',   // Electric Purple
                        },
                        difficulty: {
                            easy: '#00f3ff',     // Cyan
                            medium: '#bd00ff',   // Purple
                            hard: '#ff0055'      // Pink
                        }
                    },
                    boxShadow: {
                        'neon-cyan': '0 0 10px rgba(0, 243, 255, 0.3)',
                        'neon-pink': '0 0 10px rgba(255, 0, 85, 0.3)',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 0px; }
        ::-webkit-scrollbar-thumb:hover { background: #00f3ff; }
        
        /* Rank Colors */
        .rank-s { color: #ff0055; text-shadow: 0 0 10px #ff0055; }
        .rank-a { color: #bd00ff; text-shadow: 0 0 10px #bd00ff; }
        .rank-b { color: #00f3ff; text-shadow: 0 0 10px #00f3ff; }
        .rank-c { color: #50fa7b; }
        .rank-d { color: #f1fa8c; }
        .rank-e { color: #6272a4; }

        .loader {
            border: 2px solid #27272a;
            border-top: 2px solid #00f3ff;
            border-right: 2px solid #ff0055;
            width: 30px;
            height: 30px;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Mecha Card Clip Path */
        .mecha-card {
            clip-path: polygon(
                0 0, 
                100% 0, 
                100% calc(100% - 15px), 
                calc(100% - 15px) 100%, 
                0 100%
            );
            transition: all 0.2s ease;
        }
        .mecha-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
            border-color: #00f3ff;
        }

        /* Checkbox Animation */
        .tick-checkbox:checked + div {
            background-color: #00f3ff;
            border-color: #00f3ff;
        }
        .tick-checkbox:checked + div i {
            opacity: 1;
        }

        /* Canvas Background */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.6;
            pointer-events: none;
        }
        
        .glass-panel {
            background: rgba(18, 18, 23, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
    </style>
</head>
<body class="bg-zenith-bg text-gray-300 font-sans min-h-screen flex flex-col relative overflow-x-hidden">

    <!-- Three.js Canvas -->
    <canvas id="bg-canvas"></canvas>

    <!-- Navbar -->
    <nav class="glass-panel border-b border-zenith-border sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center gap-3">
                    <div class="relative w-8 h-8 flex items-center justify-center bg-zenith-bg border border-zenith-cyan transform rotate-45 shadow-neon-cyan">
                        <span class="transform -rotate-45 text-zenith-cyan font-bold text-lg">Z</span>
                    </div>
                    <span class="font-bold text-2xl tracking-widest text-white uppercase italic">Zenith</span>
                </div>

                <!-- Stats / XP Bar (Mini) -->
                <div class="hidden md:flex items-center gap-4 bg-zenith-bg/50 px-4 py-1 rounded border border-zenith-border">
                    <div class="text-xs text-zenith-pink font-bold uppercase" id="nav-rank">E-Rank Hunter</div>
                    <div class="w-24 h-1.5 bg-gray-800 rounded-full overflow-hidden">
                        <div id="nav-xp-bar" class="h-full bg-gradient-to-r from-zenith-cyan to-zenith-purple w-0 transition-all duration-500"></div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="flex items-center gap-4">
                    <button onclick="toggleSettings()" class="text-zenith-cyan hover:text-white transition">
                        <i class="fa-solid fa-gear text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 z-10 relative">
        
        <!-- Tabs -->
        <div class="flex mb-8 gap-6 justify-center md:justify-start">
            <button onclick="switchTab('dashboard')" id="tab-dashboard" class="group flex flex-col items-center gap-1 transition-all">
                <span class="text-lg font-bold uppercase tracking-wide group-hover:text-zenith-cyan transition-colors">Dashboard</span>
                <span class="w-0 h-0.5 bg-zenith-cyan group-hover:w-full transition-all duration-300"></span>
            </button>
            <button onclick="switchTab('problems')" id="tab-problems" class="group flex flex-col items-center gap-1 transition-all">
                <span class="text-lg font-bold uppercase tracking-wide group-hover:text-zenith-cyan transition-colors">Missions</span>
                <span class="w-0 h-0.5 bg-zenith-cyan group-hover:w-full transition-all duration-300"></span>
            </button>
            <button onclick="switchTab('contests')" id="tab-contests" class="group flex flex-col items-center gap-1 transition-all">
                <span class="text-lg font-bold uppercase tracking-wide group-hover:text-zenith-cyan transition-colors">Tournaments</span>
                <span class="w-0 h-0.5 bg-zenith-cyan group-hover:w-full transition-all duration-300"></span>
            </button>
        </div>

        <!-- Section: Dashboard (Codolio Style) -->
        <div id="view-dashboard" class="hidden space-y-8 animate-fade-in">
            
            <!-- Zenith Profile Card -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Main Stats -->
                <div class="md:col-span-2 glass-panel p-6 rounded-none relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-zenith-purple/20 blur-3xl rounded-full -mr-10 -mt-10 pointer-events-none"></div>
                    
                    <div class="flex flex-col md:flex-row gap-6 items-center md:items-start">
                        <!-- Rank Icon -->
                        <div class="relative">
                            <div class="w-24 h-24 border-2 border-dashed border-zenith-border rounded-full flex items-center justify-center relative z-10 bg-zenith-bg">
                                <i class="fa-solid fa-crown text-4xl text-yellow-500" id="dash-rank-icon"></i>
                            </div>
                            <div class="absolute inset-0 border-2 border-zenith-cyan rounded-full animate-pulse opacity-50"></div>
                        </div>
                        
                        <div class="flex-1 text-center md:text-left">
                            <h2 class="text-3xl font-bold text-white italic uppercase" id="dash-rank-title">E-Rank Hunter</h2>
                            <p class="text-zenith-cyan font-mono text-sm mb-4">ZENITH SYSTEM // STATUS: ONLINE</p>
                            
                            <div class="flex justify-between text-xs text-gray-400 mb-1 uppercase font-bold">
                                <span>Experience</span>
                                <span id="dash-xp-text">0 / 1000 XP</span>
                            </div>
                            <div class="w-full h-4 bg-gray-800 rounded overflow-hidden border border-gray-700">
                                <div id="dash-xp-bar" class="h-full bg-gradient-to-r from-zenith-cyan via-zenith-purple to-zenith-pink w-0 relative">
                                    <div class="absolute inset-0 bg-white/20 animate-[shimmer_2s_infinite]"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Platform Handles -->
                    <div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <div class="bg-zenith-bg/50 border border-zenith-border p-3 flex items-center gap-3">
                            <i class="fa-solid fa-chart-simple text-yellow-500 text-xl"></i>
                            <div class="flex-1 min-w-0">
                                <div class="text-[10px] uppercase text-gray-500">Codeforces</div>
                                <input id="handle-cf" type="text" placeholder="Link Handle" class="bg-transparent text-white text-sm font-mono w-full outline-none focus:text-zenith-cyan" onchange="saveHandles()">
                            </div>
                        </div>
                         <div class="bg-zenith-bg/50 border border-zenith-border p-3 flex items-center gap-3">
                            <i class="fa-solid fa-code text-orange-500 text-xl"></i>
                            <div class="flex-1 min-w-0">
                                <div class="text-[10px] uppercase text-gray-500">LeetCode</div>
                                <input id="handle-lc" type="text" placeholder="Link Handle" class="bg-transparent text-white text-sm font-mono w-full outline-none focus:text-zenith-cyan" onchange="saveHandles()">
                            </div>
                        </div>
                         <div class="bg-zenith-bg/50 border border-zenith-border p-3 flex items-center gap-3">
                            <i class="fa-brands fa-github text-white text-xl"></i>
                            <div class="flex-1 min-w-0">
                                <div class="text-[10px] uppercase text-gray-500">GitHub</div>
                                <input id="handle-gh" type="text" placeholder="Link Handle" class="bg-transparent text-white text-sm font-mono w-full outline-none focus:text-zenith-cyan" onchange="saveHandles()">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Circle -->
                <div class="glass-panel p-6 flex flex-col items-center justify-center text-center">
                    <div class="text-sm text-gray-400 uppercase tracking-widest mb-4">Total Solved</div>
                    <div class="text-6xl font-bold text-white font-mono" id="total-solved-count">0</div>
                    <div class="text-xs text-zenith-pink mt-2 font-mono">MISSIONS COMPLETED</div>
                    <button onclick="switchTab('problems')" class="mt-6 border border-zenith-cyan text-zenith-cyan px-6 py-2 text-sm hover:bg-zenith-cyan hover:text-black transition uppercase font-bold tracking-wider">
                        Start Hunting
                    </button>
                </div>
            </div>

            <!-- CF Profile Integration -->
            <div id="cf-integration-panel" class="hidden">
                 <h3 class="text-xl font-bold text-white italic uppercase mb-4 border-l-4 border-yellow-500 pl-3">Codeforces Data</h3>
                 <div id="profile-card" class="glass-panel p-6 flex flex-col md:flex-row gap-6 items-center">
                     <!-- Populated via JS -->
                 </div>
            </div>
        </div>

        <!-- Section: Missions (Problems) -->
        <div id="view-problems" class="hidden space-y-6">
            
            <!-- Filters -->
            <div class="glass-panel p-4 flex flex-col md:flex-row gap-4 justify-between items-center">
                <div class="flex flex-wrap gap-2 items-center w-full md:w-auto">
                    <!-- Rating Filter -->
                    <div class="relative">
                        <select id="filter-rating" onchange="applyFilters()" class="appearance-none bg-zenith-bg text-sm text-white border border-zenith-border pl-4 pr-10 py-2 focus:outline-none focus:border-zenith-cyan font-mono">
                            <option value="">// ALL LEVELS</option>
                            <option value="800-1100">LEVEL 1 [800-1100]</option>
                            <option value="1200-1500">LEVEL 2 [1200-1500]</option>
                            <option value="1600-1900">LEVEL 3 [1600-1900]</option>
                            <option value="2000-3500">LEVEL 4 [2000+]</option>
                        </select>
                        <i class="fa-solid fa-caret-down absolute right-3 top-3 text-zenith-cyan pointer-events-none"></i>
                    </div>

                    <!-- Tag Filter -->
                    <div class="relative">
                        <select id="filter-tag" onchange="applyFilters()" class="appearance-none bg-zenith-bg text-sm text-white border border-zenith-border pl-4 pr-10 py-2 focus:outline-none focus:border-zenith-cyan font-mono">
                            <option value="">// ALL TAGS</option>
                            <option value="dp">DYNAMIC_PROG</option>
                            <option value="greedy">GREEDY</option>
                            <option value="math">MATH</option>
                            <option value="graphs">GRAPHS</option>
                            <option value="constructive algorithms">CONSTRUCTIVE</option>
                            <option value="sortings">SORTING</option>
                        </select>
                        <i class="fa-solid fa-caret-down absolute right-3 top-3 text-zenith-cyan pointer-events-none"></i>
                    </div>

                    <button onclick="pickRandomProblem()" class="bg-zenith-pink/20 hover:bg-zenith-pink/40 text-zenith-pink border border-zenith-pink px-4 py-2 text-sm font-bold uppercase transition">
                        <i class="fa-solid fa-shuffle mr-2"></i> Random
                    </button>
                </div>

                <!-- Pagination -->
                <div class="flex items-center gap-1 font-mono text-sm">
                    <button onclick="prevPage()" id="btn-prev" class="w-8 h-8 flex items-center justify-center border border-zenith-border hover:border-zenith-cyan hover:text-zenith-cyan transition disabled:opacity-30"><</button>
                    <span class="px-2 text-zenith-cyan" id="page-indicator">1</span>
                    <button onclick="nextPage()" id="btn-next" class="w-8 h-8 flex items-center justify-center border border-zenith-border hover:border-zenith-cyan hover:text-zenith-cyan transition disabled:opacity-30">></button>
                </div>
            </div>

            <!-- Problem Grid -->
            <div id="problem-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <!-- Populated via JS -->
            </div>
        </div>

        <!-- Section: Contests -->
        <div id="view-contests" class="hidden space-y-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-white italic uppercase border-l-4 border-zenith-cyan pl-3">Incoming Signals</h2>
                <button onclick="fetchContests()" class="text-xs border border-zenith-border hover:border-zenith-cyan px-3 py-1 text-gray-400 hover:text-white transition">
                    REFRESH
                </button>
            </div>
            <div class="glass-panel overflow-hidden">
                <table class="w-full text-left text-sm text-gray-400">
                    <thead class="bg-zenith-bg text-zenith-cyan uppercase font-bold text-xs font-mono tracking-wider">
                        <tr>
                            <th class="px-6 py-4">Operation Name</th>
                            <th class="px-6 py-4">Class</th>
                            <th class="px-6 py-4">Time</th>
                            <th class="px-6 py-4">T-Minus</th>
                        </tr>
                    </thead>
                    <tbody id="contest-list" class="divide-y divide-zenith-border font-mono">
                        <tr><td colspan="4" class="px-6 py-8 text-center">SCANNING FREQUENCIES...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <!-- Settings Modal -->
    <div id="settings-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[100] hidden flex items-center justify-center">
        <div class="glass-panel p-8 w-full max-w-md border border-zenith-border relative shadow-neon-pink">
            <div class="absolute top-0 left-0 w-2 h-2 bg-zenith-cyan"></div>
            <div class="absolute top-0 right-0 w-2 h-2 bg-zenith-cyan"></div>
            <div class="absolute bottom-0 left-0 w-2 h-2 bg-zenith-cyan"></div>
            <div class="absolute bottom-0 right-0 w-2 h-2 bg-zenith-cyan"></div>

            <h3 class="text-xl font-bold text-white uppercase italic mb-6 text-center">System Config</h3>
            
            <div class="space-y-4 font-mono text-sm">
                <div>
                    <label class="block text-zenith-cyan mb-1">> API_KEY</label>
                    <input type="text" id="input-api-key" class="w-full bg-zenith-bg border border-zenith-border px-3 py-2 text-white focus:border-zenith-pink outline-none">
                </div>
                <div>
                    <label class="block text-zenith-cyan mb-1">> API_SECRET</label>
                    <input type="password" id="input-api-secret" class="w-full bg-zenith-bg border border-zenith-border px-3 py-2 text-white focus:border-zenith-pink outline-none">
                </div>
                <div>
                     <label class="block text-zenith-cyan mb-1">> RESET_DATA</label>
                     <button onclick="resetProgress()" class="text-red-500 hover:text-red-400 text-xs underline">Clear All Solved Problems</button>
                </div>
            </div>

            <div class="mt-8 flex gap-3">
                <button onclick="toggleSettings()" class="flex-1 border border-zenith-border py-2 text-gray-400 hover:text-white uppercase font-bold">Cancel</button>
                <button onclick="saveSettings()" class="flex-1 bg-zenith-pink hover:bg-red-600 text-white py-2 uppercase font-bold tracking-wider">Save</button>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-5 right-5 glass-panel text-white px-6 py-3 border-l-4 border-zenith-cyan transform translate-y-32 transition-transform duration-300 z-[200] font-mono text-sm">
        <span class="text-zenith-cyan mr-2">>></span> <span id="toast-msg">System Ready</span>
    </div>

    <script>
        // --- State Management ---
        const state = {
            apiKey: sessionStorage.getItem('cf_key') || '',
            apiSecret: sessionStorage.getItem('cf_secret') || '',
            currentTab: 'dashboard',
            
            // User Data
            handles: JSON.parse(localStorage.getItem('zenith_handles') || '{"cf":"","lc":"","gh":""}'),
            solvedProblems: new Set(JSON.parse(localStorage.getItem('zenith_solved') || '[]')),
            xp: 0,
            
            // Data
            allProblems: [],
            filteredProblems: [],
            currentPage: 1,
            itemsPerPage: 16,
            problemsLoaded: false
        };

        // --- Rank System Logic ---
        const RANKS = [
            { name: "E-Rank Hunter", minXp: 0, color: "rank-e" },
            { name: "D-Rank Hunter", minXp: 200, color: "rank-d" },
            { name: "C-Rank Hunter", minXp: 600, color: "rank-c" },
            { name: "B-Rank Assassin", minXp: 1500, color: "rank-b" },
            { name: "A-Rank Elite", minXp: 3000, color: "rank-a" },
            { name: "S-Rank Monarch", minXp: 6000, color: "rank-s" }
        ];

        function calculateXP() {
            let totalXP = 0;
            // Iterate solved IDs. We need the problem details to calculate accurate XP.
            // Since we might not have 'allProblems' loaded initially, we estimate or use stored XP if complex.
            // For simplicity in this demo, we assume 1 Problem = 10 XP + (Rating/100).
            // But we only have the ID stored. 
            // IMPROVEMENT: Store {id, rating} in localStorage for better calculation, 
            // or just iterate current problem list if available.
            
            // Simple approach: Count * 25 XP base.
            totalXP = state.solvedProblems.size * 50; 
            state.xp = totalXP;
            updateRankDisplay();
        }

        function updateRankDisplay() {
            let currentRank = RANKS[0];
            let nextRankXP = RANKS[1].minXp;

            for (let i = 0; i < RANKS.length; i++) {
                if (state.xp >= RANKS[i].minXp) {
                    currentRank = RANKS[i];
                    nextRankXP = RANKS[i+1] ? RANKS[i+1].minXp : state.xp * 1.5;
                }
            }

            const progress = Math.min(100, ((state.xp - currentRank.minXp) / (nextRankXP - currentRank.minXp)) * 100);

            // Update UI
            getEl('nav-rank').innerText = currentRank.name;
            getEl('nav-rank').className = `text-xs font-bold uppercase ${currentRank.color}`;
            getEl('nav-xp-bar').style.width = `${progress}%`;

            getEl('dash-rank-title').innerText = currentRank.name;
            getEl('dash-rank-title').className = `text-3xl font-bold italic uppercase ${currentRank.color}`;
            getEl('dash-xp-text').innerText = `${state.xp} / ${nextRankXP} XP`;
            getEl('dash-xp-bar').style.width = `${progress}%`;
            getEl('total-solved-count').innerText = state.solvedProblems.size;

            // Icon color update
            const icon = getEl('dash-rank-icon');
            if(currentRank.name.includes("S-Rank")) icon.className = "fa-solid fa-crown text-4xl text-zenith-pink animate-pulse";
            else if(currentRank.name.includes("A-Rank")) icon.className = "fa-solid fa-dragon text-4xl text-zenith-purple";
            else if(currentRank.name.includes("B-Rank")) icon.className = "fa-solid fa-khanda text-4xl text-zenith-cyan";
            else icon.className = "fa-solid fa-shield-halved text-4xl text-gray-500";
        }

        // --- Core Utils ---
        const getEl = (id) => document.getElementById(id);
        const showToast = (msg) => {
            const toast = getEl('toast');
            getEl('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-32');
            setTimeout(() => toast.classList.add('translate-y-32'), 3000);
        };

        // --- Problem Tracking (The "Hunter" System) ---
        function toggleProblem(id) {
            if (state.solvedProblems.has(id)) {
                state.solvedProblems.delete(id);
                showToast("Mission status: INCOMPLETE");
            } else {
                state.solvedProblems.add(id);
                showToast("Mission COMPLETE. XP Gained.");
                
                // Play subtle sound? (Optional, skipping for simplicity)
            }
            localStorage.setItem('zenith_solved', JSON.stringify([...state.solvedProblems]));
            calculateXP();
            
            // Update Card UI if visible
            const checkbox = document.getElementById(`check-${id}`);
            const card = document.getElementById(`card-${id}`);
            if(checkbox && card) {
                if(checkbox.checked) {
                    card.classList.add('border-zenith-cyan', 'shadow-neon-cyan');
                    card.classList.remove('border-zenith-border');
                } else {
                    card.classList.remove('border-zenith-cyan', 'shadow-neon-cyan');
                    card.classList.add('border-zenith-border');
                }
            }
        }
        
        function resetProgress() {
            if(confirm("WARNING: This will reset all your XP and solved history. Proceed?")) {
                state.solvedProblems.clear();
                localStorage.setItem('zenith_solved', '[]');
                calculateXP();
                renderProblems();
                showToast("System Reset Complete.");
            }
        }

        // --- API Logic (Standard) ---
        // (Keeping existing logic for CF fetching)
        async function cfFetch(method, params = {}) {
            // ... (Same signature logic as previous version)
            const baseUrl = 'https://codeforces.com/api/';
            const urlParams = new URLSearchParams(params);
            try {
                const res = await fetch(`${baseUrl}${method}?${urlParams}`);
                const data = await res.json();
                if(data.status === 'OK') return data.result;
                else return null;
            } catch(e) { console.error(e); return null; }
        }

        // --- UI Logic ---
        function switchTab(tabId) {
            ['dashboard', 'problems', 'contests'].forEach(t => {
                const btn = getEl(`tab-${t}`);
                const view = getEl(`view-${t}`);
                const span = btn.querySelector('span:last-child'); // The underline
                const text = btn.querySelector('span:first-child');
                
                if (t === tabId) {
                    view.classList.remove('hidden');
                    text.classList.add('text-zenith-cyan');
                    span.classList.remove('w-0');
                    span.classList.add('w-full');
                } else {
                    view.classList.add('hidden');
                    text.classList.remove('text-zenith-cyan');
                    span.classList.remove('w-full');
                    span.classList.add('w-0');
                }
            });

            if (tabId === 'problems') initProblems();
            if (tabId === 'contests') fetchContests();
            if (tabId === 'dashboard') loadDashboard();
        }

        function loadDashboard() {
            // Fill inputs
            getEl('handle-cf').value = state.handles.cf;
            getEl('handle-lc').value = state.handles.lc;
            getEl('handle-gh').value = state.handles.gh;
            
            // If CF handle exists, fetch real data
            if(state.handles.cf) {
                fetchCFProfile(state.handles.cf);
            }
        }

        function saveHandles() {
            state.handles.cf = getEl('handle-cf').value.trim();
            state.handles.lc = getEl('handle-lc').value.trim();
            state.handles.gh = getEl('handle-gh').value.trim();
            localStorage.setItem('zenith_handles', JSON.stringify(state.handles));
            showToast("Identities Updated");
            
            if(state.handles.cf) fetchCFProfile(state.handles.cf);
        }

        async function fetchCFProfile(handle) {
            const panel = getEl('cf-integration-panel');
            const card = getEl('profile-card');
            
            const data = await cfFetch('user.info', { handles: handle });
            if(data && data[0]) {
                const u = data[0];
                panel.classList.remove('hidden');
                card.innerHTML = `
                    <img src="${u.titlePhoto}" class="w-20 h-20 rounded border-2 border-zenith-cyan">
                    <div>
                        <div class="text-2xl font-bold text-white">${u.handle}</div>
                        <div class="text-zenith-cyan uppercase text-sm">${u.rank || 'Unrated'}</div>
                        <div class="mt-2 text-gray-400 text-xs font-mono">RATING: <span class="text-white">${u.rating}</span></div>
                    </div>
                `;
            }
        }

        // --- Problems View ---
        async function initProblems() {
            if (state.problemsLoaded) return;
            const grid = getEl('problem-grid');
            grid.innerHTML = '<div class="col-span-full flex justify-center py-20"><div class="loader"></div></div>';

            const data = await cfFetch('problemset.problems');
            if (data && data.problems) {
                state.allProblems = data.problems;
                applyFilters();
                state.problemsLoaded = true;
            } else {
                grid.innerHTML = '<div class="col-span-full text-center text-red-500 font-mono">LINK FAILURE</div>';
            }
        }

        function applyFilters() {
            const tag = getEl('filter-tag').value;
            const rating = getEl('filter-rating').value;
            
            state.filteredProblems = state.allProblems.filter(p => {
                let mTag = !tag || p.tags.includes(tag);
                let mRat = true;
                if (rating) {
                    const r = p.rating || 0;
                    const [min, max] = rating.split('-').map(Number);
                    if (r < min || r > max) mRat = false;
                }
                return mTag && mRat;
            });
            state.currentPage = 1;
            renderProblems();
        }

        function renderProblems() {
            const grid = getEl('problem-grid');
            const start = (state.currentPage - 1) * state.itemsPerPage;
            const pageData = state.filteredProblems.slice(start, start + state.itemsPerPage);

            getEl('page-indicator').innerText = state.currentPage;
            getEl('btn-prev').disabled = state.currentPage === 1;
            getEl('btn-next').disabled = (start + state.itemsPerPage) >= state.filteredProblems.length;

            grid.innerHTML = pageData.map(p => {
                const id = `${p.contestId}${p.index}`;
                const isSolved = state.solvedProblems.has(id);
                
                // Style Logic
                let diffColor = 'text-zenith-cyan';
                if(p.rating >= 1400) diffColor = 'text-zenith-purple';
                if(p.rating >= 1900) diffColor = 'text-zenith-pink';
                
                const cardBorder = isSolved ? 'border-zenith-cyan shadow-neon-cyan' : 'border-zenith-border';

                return `
                <div id="card-${id}" class="mecha-card bg-zenith-card border ${cardBorder} p-5 flex flex-col justify-between h-full group relative overflow-hidden">
                    
                    <!-- Tech decoration -->
                    <div class="absolute top-0 right-0 p-1">
                        <div class="w-16 h-1 bg-white/5 rotate-45 transform translate-x-4 -translate-y-2"></div>
                    </div>

                    <div>
                        <div class="flex justify-between items-start mb-2 pl-8 relative">
                             <!-- Checkbox Mechanism -->
                            <label class="absolute left-0 top-0 cursor-pointer group-checkbox">
                                <input type="checkbox" id="check-${id}" class="hidden tick-checkbox" onchange="toggleProblem('${id}')" ${isSolved ? 'checked' : ''}>
                                <div class="w-6 h-6 border border-gray-600 bg-black flex items-center justify-center transition-all hover:border-white">
                                    <i class="fa-solid fa-check text-black text-xs opacity-0 transition-opacity"></i>
                                </div>
                            </label>

                            <span class="${diffColor} text-xs font-bold font-mono tracking-widest">${p.rating || 'N/A'}</span>
                            <span class="text-[10px] text-gray-500 font-mono border border-gray-800 px-1">${p.contestId}${p.index}</span>
                        </div>
                        
                        <h3 class="text-white font-bold text-lg leading-tight mb-3 group-hover:text-zenith-cyan transition-colors line-clamp-2 uppercase italic" title="${p.name}">
                            ${p.name}
                        </h3>
                        
                        <div class="flex flex-wrap gap-1 mb-4">
                            ${p.tags.slice(0, 3).map(t => `<span class="text-[9px] bg-zenith-bg text-gray-400 border border-zenith-border px-1.5 py-0.5 uppercase tracking-wide">${t}</span>`).join('')}
                        </div>
                    </div>

                    <a href="https://codeforces.com/contest/${p.contestId}/problem/${p.index}" target="_blank" class="block text-center border border-dashed border-gray-700 hover:border-zenith-cyan hover:text-zenith-cyan py-2 text-xs font-mono uppercase transition">
                        >> EXECUTE MISSION
                    </a>
                </div>
                `;
            }).join('');
        }
        
        function nextPage() { state.currentPage++; renderProblems(); window.scrollTo(0,0); }
        function prevPage() { if(state.currentPage > 1) { state.currentPage--; renderProblems(); window.scrollTo(0,0); } }

        function pickRandomProblem() {
            if(state.filteredProblems.length) {
                const p = state.filteredProblems[Math.floor(Math.random() * state.filteredProblems.length)];
                window.open(`https://codeforces.com/contest/${p.contestId}/problem/${p.index}`, '_blank');
            }
        }

        // --- Contests View ---
        async function fetchContests() {
            const list = getEl('contest-list');
            list.innerHTML = '<tr><td colspan="4" class="px-6 py-8 text-center"><div class="loader mx-auto"></div></td></tr>';
            
            const data = await cfFetch('contest.list', {gym: false});
            if(!data) return;
            
            const upcoming = data.filter(c => c.phase === 'BEFORE').reverse().slice(0, 10);
            list.innerHTML = upcoming.map(c => {
                 const start = new Date(c.startTimeSeconds * 1000);
                 const now = new Date();
                 const diff = start - now;
                 const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                 
                 return `
                 <tr class="hover:bg-white/5 transition border-b border-zenith-border last:border-0">
                    <td class="px-6 py-4 font-bold text-white uppercase italic">${c.name}</td>
                    <td class="px-6 py-4 text-xs font-mono text-gray-500">${c.type}</td>
                    <td class="px-6 py-4 text-xs font-mono">${start.toLocaleString()}</td>
                    <td class="px-6 py-4 text-zenith-cyan font-mono font-bold">T-MINUS ${days} DAYS</td>
                 </tr>
                 `;
            }).join('');
        }
        
        function toggleSettings() {
             const m = getEl('settings-modal');
             m.classList.toggle('hidden');
        }

        // --- Init ---
        calculateXP(); // Load initial XP from storage
        switchTab('dashboard');
    </script>

    <!-- Visuals (Three.js) -->
    <script type="module">
        import * as THREE from 'three';
        
        const canvas = document.getElementById('bg-canvas');
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.z = 500;
        
        // Cyberpunk Particles (Cyan & Pink)
        const geometry = new THREE.BufferGeometry();
        const count = 400;
        const positions = new Float32Array(count * 3);
        const colors = new Float32Array(count * 3);
        
        const color1 = new THREE.Color(0x00f3ff); // Cyan
        const color2 = new THREE.Color(0xff0055); // Pink
        
        for(let i=0; i<count; i++) {
            positions[i*3] = (Math.random()-0.5)*1000;
            positions[i*3+1] = (Math.random()-0.5)*1000;
            positions[i*3+2] = (Math.random()-0.5)*1000;
            
            const c = Math.random() > 0.5 ? color1 : color2;
            colors[i*3] = c.r;
            colors[i*3+1] = c.g;
            colors[i*3+2] = c.b;
        }
        
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        
        const material = new THREE.PointsMaterial({
            size: 3,
            vertexColors: true,
            transparent: true,
            opacity: 0.8,
            blending: THREE.AdditiveBlending
        });
        
        const particles = new THREE.Points(geometry, material);
        scene.add(particles);
        
        // Animation
        const animate = () => {
            requestAnimationFrame(animate);
            scene.rotation.y += 0.001;
            scene.rotation.x += 0.0005;
            renderer.render(scene, camera);
        }
        animate();
        
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
